<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>æ¥ç”¨Vite+Reactå¿«é€Ÿå¼€å‘æµè§ˆå™¨æ’ä»¶ | å­¦ä¹ ç¬”è®°</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/space/assets/css/0.styles.44c8a9cb.css" as="style"><link rel="preload" href="/space/assets/js/app.c334109e.js" as="script"><link rel="preload" href="/space/assets/js/2.733019b2.js" as="script"><link rel="preload" href="/space/assets/js/12.b9c16781.js" as="script"><link rel="prefetch" href="/space/assets/js/10.d3dbcd01.js"><link rel="prefetch" href="/space/assets/js/11.419a1f1a.js"><link rel="prefetch" href="/space/assets/js/13.e25e3787.js"><link rel="prefetch" href="/space/assets/js/14.b4f61ea2.js"><link rel="prefetch" href="/space/assets/js/15.bebbaa9f.js"><link rel="prefetch" href="/space/assets/js/16.c43e8ad7.js"><link rel="prefetch" href="/space/assets/js/17.f2e1347b.js"><link rel="prefetch" href="/space/assets/js/18.5d362097.js"><link rel="prefetch" href="/space/assets/js/19.efd9e707.js"><link rel="prefetch" href="/space/assets/js/20.19342614.js"><link rel="prefetch" href="/space/assets/js/21.c4132e43.js"><link rel="prefetch" href="/space/assets/js/22.c8d95e73.js"><link rel="prefetch" href="/space/assets/js/23.9a276b89.js"><link rel="prefetch" href="/space/assets/js/24.90abfcc9.js"><link rel="prefetch" href="/space/assets/js/25.1da64438.js"><link rel="prefetch" href="/space/assets/js/26.e8493b44.js"><link rel="prefetch" href="/space/assets/js/27.7b13507c.js"><link rel="prefetch" href="/space/assets/js/3.40aa7a3d.js"><link rel="prefetch" href="/space/assets/js/4.da3ef268.js"><link rel="prefetch" href="/space/assets/js/5.dac787d8.js"><link rel="prefetch" href="/space/assets/js/6.820ab661.js"><link rel="prefetch" href="/space/assets/js/7.b04aeb28.js"><link rel="prefetch" href="/space/assets/js/8.8733fc27.js"><link rel="prefetch" href="/space/assets/js/9.76eb16d3.js">
    <link rel="stylesheet" href="/space/assets/css/0.styles.44c8a9cb.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/space/" class="home-link router-link-active"><!----> <span class="site-name">å­¦ä¹ ç¬”è®°</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/space/blog/" aria-current="page" class="sidebar-link">ç®€ä»‹</a></li><li><a href="/space/blog/15.html" class="sidebar-link">ğŸµå¥½è®©äººå‚»å‚»åˆ†ä¸æ¸…â€”JSç¯‡</a></li><li><a href="/space/blog/14.html" class="sidebar-link">ğŸ­å¥½è®©äººå‚»å‚»åˆ†ä¸æ¸…â€”DOMç¯‡</a></li><li><a href="/space/blog/13.html" class="sidebar-link">ğŸ¯å¥½è®©äººå‚»å‚»åˆ†ä¸æ¸…â€”CSSç¯‡</a></li><li><a href="/space/blog/12.html" class="sidebar-link">è¿™ä¹ˆå¤šå¹´ä½ è¿˜åœ¨æ€•æ­£åˆ™å—ï¼Ÿ</a></li><li><a href="/space/blog/11.html" aria-current="page" class="active sidebar-link">æ¥ç”¨Vite+Reactå¿«é€Ÿå¼€å‘æµè§ˆå™¨æ’ä»¶</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/space/blog/11.html#å‰è¨€" class="sidebar-link">å‰è¨€</a></li><li class="sidebar-sub-header"><a href="/space/blog/11.html#å®‰è£…" class="sidebar-link">å®‰è£…</a></li><li class="sidebar-sub-header"><a href="/space/blog/11.html#ç»„æˆç»“æ„" class="sidebar-link">ç»„æˆç»“æ„</a></li><li class="sidebar-sub-header"><a href="/space/blog/11.html#åŠ è½½ä¸è°ƒè¯•" class="sidebar-link">åŠ è½½ä¸è°ƒè¯•</a></li><li class="sidebar-sub-header"><a href="/space/blog/11.html#æ¨¡å—é—´é€šä¿¡" class="sidebar-link">æ¨¡å—é—´é€šä¿¡</a></li><li class="sidebar-sub-header"><a href="/space/blog/11.html#æ‰“åŒ…å‘å¸ƒ" class="sidebar-link">æ‰“åŒ…å‘å¸ƒ</a></li><li class="sidebar-sub-header"><a href="/space/blog/11.html#ç»“æŸè¯­" class="sidebar-link">ç»“æŸè¯­</a></li></ul></li><li><a href="/space/blog/10.html" class="sidebar-link">ä¼—æ‰€å‘¨çŸ¥çš„æµè§ˆå™¨è°ƒè¯•æ“ä½œ</a></li><li><a href="/space/blog/9.html" class="sidebar-link">ç®€å•çš„å…ƒç´ æ»šåŠ¨ç»„ä»¶</a></li><li><a href="/space/blog/8.html" class="sidebar-link">æ¥ä¸€ä¸ªç®€å•äºŒç»´ç ç”Ÿæˆå™¨</a></li><li><a href="/space/blog/7.html" class="sidebar-link">ç”¨ CSS æ‰¾å›ç«¥å¹´çš„å¿«ä¹ï¼Œå“†å•¦Aæ¢¦ä¼´ä½ åŒè¡Œ</a></li><li><a href="/space/blog/6.html" class="sidebar-link">520ï¼Œ å­¦åºŸ new å¯¹è±¡çš„è¿‡ç¨‹</a></li><li><a href="/space/blog/5.html" class="sidebar-link">è¿™ä¸ª&quot;this&quot;åˆ°åº•æ˜¯ä»€ä¹ˆ</a></li><li><a href="/space/blog/4.html" class="sidebar-link">10 åˆ†é’ŸæŒæ¡æµè§ˆå™¨è¿è¡Œ JS çš„é¡ºåº</a></li><li><a href="/space/blog/3.html" class="sidebar-link">é˜²æŠ–èŠ‚æµçœ‹è¿™ç¯‡å°±å¤Ÿäº†</a></li><li><a href="/space/blog/2.html" class="sidebar-link">æ˜¯æ—¶å€™ç”¨é—­åŒ…å®ç°ä¸€ä¸ªç¼“å­˜å‡½æ•°äº†</a></li><li><a href="/space/blog/1.html" class="sidebar-link">ä¸å¾—ä¸çŸ¥çš„é—­åŒ…</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="æ¥ç”¨vite-reactå¿«é€Ÿå¼€å‘æµè§ˆå™¨æ’ä»¶"><a href="#æ¥ç”¨vite-reactå¿«é€Ÿå¼€å‘æµè§ˆå™¨æ’ä»¶" class="header-anchor">#</a> æ¥ç”¨Vite+Reactå¿«é€Ÿå¼€å‘æµè§ˆå™¨æ’ä»¶</h1> <h2 id="å‰è¨€"><a href="#å‰è¨€" class="header-anchor">#</a> å‰è¨€</h2> <p>æ¯å½“çœ‹åˆ°å¥½çš„æ–‡ç« æˆ–è€…å¥½çš„è§†é¢‘ï¼Œåº•ä¸‹æ€»æœ‰é‚£ä¹ˆä¸€äº›é•¿å¾—å¥½çœ‹ï¼Œè¯´è¯æœ‰å¥½å¬çš„äººæ‰ã€‚æ²¡æœ‰æ–‡åŒ–çš„æˆ‘åªèƒ½é»˜é»˜çš„ç•™ä¸‹ä¸äº‰æ°”çš„â€œå§æ§½ï¼Œç‰›é€¼ï¼</p> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/30be24c37ebd4efd9bf581e71c8ffc56~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p> <p>åŒæ ·æ˜¯è…°é—´ç›˜ï¼Œä¸ºä½•æ±å¦‚æ­¤çªå‡ºã€‚åŒæ ·ä¹å¹´ä¹‰åŠ¡æ•™è‚²ï¼Œä¸ºä½•æ±å¦‚æ­¤ä¼˜ç§€ã€‚ç—›å®šæ€ç—›ï¼Œæˆ‘å†³å®šè¦å‘ä»–ä»¬å­¦ä¹ ã€‚äºæ˜¯ç§‰ç€æ”¶è—å³å­¦ä¼šçš„åŸåˆ™ï¼Œæˆ‘è¦ç”¨ React &amp; Antd  &amp; Vite å¿«é€Ÿåšä¸€ä¸ª chrome æ‰©å±•ç¨‹åº(å¸¸ç”¨åï¼šæ’ä»¶) -- è¯­å½•æ”¶è—ã€‚å¤§ä½“çš„åŠŸèƒ½æ˜¯å¯ä»¥é€‰ä¸­ä¸€æ®µè¯ï¼Œå³é”®å¯ä»¥ä¿å­˜åˆ°ä¸ªäººè¯­å½•ä¸­ã€‚ç‚¹å‡»è¾“å…¥æ¡†ä¼šå°†æ‰€æœ‰ä¿å­˜çš„è¯­å½•å¼¹çª—æ˜¾ç¤ºï¼Œå¯ä¾›æˆ‘ä»¬å¿«æ·è¾“å…¥ã€‚ç‚¹å‡»æ’ä»¶ä¼šéšæœºæ˜¾ç¤ºä¸€æ®µå¿ƒçµé¸¡æ±¤ï¼Œå¯ä»¥éšæ—¶è¡¥å……è¯­å½•ã€‚</p> <h2 id="å®‰è£…"><a href="#å®‰è£…" class="header-anchor">#</a> å®‰è£…</h2> <div class="language-powershell extra-class"><pre class="language-powershell"><code>yarn create vite my-extension <span class="token operator">--</span>template react-ts
</code></pre></div><p>æˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ª <code>react-ts</code> çš„å·¥ç¨‹</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code>yarn add antd
</code></pre></div><p>æ¥ç€å®‰è£…å®Œ <code>antd</code>ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹ä¸‹é¢çš„å·¥ä½œäº†</p> <h3 id="æ”¹é€ å¤šé¡µé¢é…ç½®"><a href="#æ”¹é€ å¤šé¡µé¢é…ç½®" class="header-anchor">#</a> æ”¹é€ å¤šé¡µé¢é…ç½®</h3> <p>æ ¹æ® <a href="https://cn.vitejs.dev/guide/build.html#multi-page-app" target="_blank" rel="noopener noreferrer">Vite å®˜æ–¹æ–‡æ¡£<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> æŠŠå®ƒæ”¹é€ æˆä¸€ä¸ªå¤šé¡µé¢çš„å·¥ç¨‹ã€‚å¤šé¡µé¢çš„ <code>vite.config.ts</code> å¦‚ä¸‹ï¼š</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vite&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> react <span class="token keyword">from</span> <span class="token string">&quot;@vitejs/plugin-react&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> path<span class="token punctuation">,</span> <span class="token punctuation">{</span> resolve <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;path&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> makeManifest <span class="token keyword">from</span> <span class="token string">&quot;./utils/plugins/make-manifest&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> customDynamicImport <span class="token keyword">from</span> <span class="token string">'./utils/plugins/custom-dynamic-import'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> vitePluginImp <span class="token keyword">from</span> <span class="token string">'vite-plugin-imp'</span>

<span class="token keyword">const</span> root <span class="token operator">=</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;src&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> pagesDir <span class="token operator">=</span> <span class="token function">resolve</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> <span class="token string">&quot;pages&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> assetsDir <span class="token operator">=</span> <span class="token function">resolve</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> <span class="token string">&quot;assets&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> publicDir <span class="token operator">=</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;public&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> outDir <span class="token operator">=</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;dist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> isDev <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>__DEV__ <span class="token operator">===</span> <span class="token string">&quot;true&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// https://vitejs.dev/config/</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
    alias<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;@src&quot;</span><span class="token operator">:</span> root<span class="token punctuation">,</span>
      <span class="token string-property property">&quot;@assets&quot;</span><span class="token operator">:</span> assetsDir<span class="token punctuation">,</span>
      <span class="token string-property property">&quot;@pages&quot;</span><span class="token operator">:</span> pagesDir<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">react</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
    <span class="token function">makeManifest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
    <span class="token function">customDynamicImport</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// æŒ‰éœ€åŠ è½½é…ç½®</span>
    <span class="token function">vitePluginImp</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      libList<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          libName<span class="token operator">:</span> <span class="token string">&quot;antd&quot;</span><span class="token punctuation">,</span>
          <span class="token function-variable function">style</span><span class="token operator">:</span> <span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">antd/es/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/style</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  publicDir<span class="token punctuation">,</span>
  build<span class="token operator">:</span> <span class="token punctuation">{</span>
    outDir<span class="token punctuation">,</span>
    sourcemap<span class="token operator">:</span> isDev<span class="token punctuation">,</span>
    rollupOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
      input<span class="token operator">:</span> <span class="token punctuation">{</span>
        popup<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>pagesDir<span class="token punctuation">,</span> <span class="token string">&quot;popup&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;index.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        options<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>pagesDir<span class="token punctuation">,</span> <span class="token string">&quot;options&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;index.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        background<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>pagesDir<span class="token punctuation">,</span> <span class="token string">&quot;background&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;index.ts&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">// content éœ€è¦åœ¨ manifest ä¸­æŒ‡å®š css èµ„æº</span>
        content<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>pagesDir<span class="token punctuation">,</span> <span class="token string">&quot;content&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;index.ts&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        contentStyle<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>pagesDir<span class="token punctuation">,</span> <span class="token string">&quot;content&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;style.less&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      output<span class="token operator">:</span> <span class="token punctuation">{</span>
        entryFileNames<span class="token operator">:</span> <span class="token string">&quot;src/pages/[name]/index.js&quot;</span><span class="token punctuation">,</span>
        chunkFileNames<span class="token operator">:</span> isDev
          <span class="token operator">?</span> <span class="token string">&quot;assets/js/[name].js&quot;</span>
          <span class="token operator">:</span> <span class="token string">&quot;assets/js/[name].[hash].js&quot;</span><span class="token punctuation">,</span>
        assetFileNames<span class="token operator">:</span> <span class="token punctuation">(</span>assetInfo<span class="token operator">:</span> <span class="token punctuation">{</span>
          name<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
          source<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> Uint8Array<span class="token punctuation">;</span>
          type<span class="token operator">:</span> <span class="token string">'asset'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> <span class="token punctuation">{</span> dir<span class="token punctuation">,</span> name<span class="token operator">:</span> _name <span class="token punctuation">}</span> <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>assetInfo<span class="token punctuation">.</span>name <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">const</span> assetFolder <span class="token operator">=</span> <span class="token function">getLastElement</span><span class="token punctuation">(</span>dir<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">const</span> name <span class="token operator">=</span> assetFolder <span class="token operator">+</span> <span class="token function">firstUpperCase</span><span class="token punctuation">(</span>_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">assets/[ext]/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.chunk.[ext]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  css<span class="token operator">:</span> <span class="token punctuation">{</span>
    preprocessorOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
      less<span class="token operator">:</span> <span class="token punctuation">{</span>
        javascriptEnabled<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        modifyVars<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string-property property">'@primary-color'</span><span class="token operator">:</span> <span class="token string">'#1e80ff'</span><span class="token punctuation">,</span>	<span class="token comment">// è®¾ç½® antd ä¸»é¢˜è‰²</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">getLastElement</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>array<span class="token operator">:</span> ArrayLike<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> length <span class="token operator">=</span> array<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
  <span class="token keyword">const</span> lastIndex <span class="token operator">=</span> length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> array<span class="token punctuation">[</span>lastIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">firstUpperCase</span><span class="token punctuation">(</span>str<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> firstAlphabet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">( |^)[a-z]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">&quot;g&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> str<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>firstAlphabet<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token constant">L</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">L</span><span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>è¿™é‡Œæœ‰å‡ ä¸ªç‚¹éœ€è¦æ³¨æ„ä¸‹ï¼š</p> <ul><li>é€šè¿‡ <code>vite-plugin-imp</code> æŒ‰éœ€åŠ è½½ <code>antd</code></li> <li>contentStyle ä¸º Content script å†…å®¹è„šæœ¬(ä¸‹æ–‡ä¼šä»‹ç»)æŒ‡å®šçš„æ ·å¼ï¼Œéœ€è¦å•ç‹¬æŒ‡å®š</li> <li>make-manifestã€custom-dynamic-import è¿™ä¸¤ä¸ªè‡ªå®šä¹‰æ’ä»¶åˆ†åˆ«æ˜¯ä¸ºäº†å¤„ç† manifest å’Œ content åŠ¨æ€å¯¼å…¥</li></ul> <h3 id="nodemon-è‡ªåŠ¨æ›´æ–°"><a href="#nodemon-è‡ªåŠ¨æ›´æ–°" class="header-anchor">#</a> Nodemon è‡ªåŠ¨æ›´æ–°</h3> <p>ä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬å¿«æ·å¼€å‘ï¼Œæˆ‘ä»¬å®‰è£…ä¸€ä¸‹ nodemon è‡ªåŠ¨æ›´æ–°</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code>yarn global add nodemon
æˆ–è€…
yarn add nodemon <span class="token operator">--</span>dev
</code></pre></div><p>æ·»åŠ  <code>nodemon.json</code> é…ç½®æ–‡ä»¶</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;env&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;__DEV__&quot;</span><span class="token operator">:</span> <span class="token string">&quot;true&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;watch&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;src&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;utils&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;vite.config.ts&quot;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;ext&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tsx,css,scss,html,ts&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;ignore&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;src/**/*.spec.ts&quot;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;exec&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node_modules/.bin/vite build&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>è‡³æ­¤ï¼Œè„šæ‰‹æ¶ç›¸å…³é…ç½®æå®šäº†ï¼Œç®€ç®€å•å•ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¦å¼€å§‹æ’ä»¶ç›¸å…³çš„å·¥ä½œäº†ã€‚</p> <h2 id="ç»„æˆç»“æ„"><a href="#ç»„æˆç»“æ„" class="header-anchor">#</a> ç»„æˆç»“æ„</h2> <p>é¦–å…ˆç®€å•äº†è§£ä¸€ä¸‹æ’ä»¶çš„æ•´ä½“ç»“æ„ï¼Œå›  V2 ç‰ˆæœ¬å³å°†è¿‡æœŸï¼Œæˆ‘ä»¬ç›´æ¥ç”¨ V3 çš„ç‰ˆæœ¬ã€‚
<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/afd716e221fc4bdea34fce0679febf3b~tplv-k3u1fbpfcp-zoom-1.image" alt="image.png"></p> <p>æ’ä»¶çš„ç»„æˆç»“æ„å–å†³äºå®ƒçš„åŠŸèƒ½ï¼Œä½†æ˜¯æ‰€æœ‰æ‰©å±•éƒ½å¿…é¡»æœ‰ä¸€ä¸ª manifest çš„æ¸…å•ã€‚ä»¥ä¸‹æ˜¯æ’ä»¶åŒ…å«çš„æ‰€æœ‰æ¨¡å—ï¼š</p> <ul><li><strong>Manifest</strong>ï¼šå‘æµè§ˆå™¨æä¾›å…³äºæ’ä»¶çš„ä¿¡æ¯ï¼Œä¾‹å¦‚å¯èƒ½ä½¿ç”¨çš„åŠŸèƒ½å’Œå›¾æ ‡ã€æ‰§è¡Œè„šæœ¬æ–‡ä»¶ç­‰é‡è¦çš„æ–‡ä»¶ã€‚</li> <li><strong>Service worker</strong>ï¼šæ’ä»¶äº‹ä»¶å¤„ç†ç¨‹åºï¼ŒåŒ…å«äº†æµè§ˆå™¨äº‹ä»¶çš„ç›‘å¬å™¨ã€‚å¯ä»¥è®¿é—®æ‰€æœ‰çš„ Chrome apiï¼šå®ç°è·¨åŸŸè¯·æ±‚ã€ç½‘é¡µæˆªå±ã€å¼¹å‡º chrome é€šçŸ¥æ¶ˆæ¯ç­‰åŠŸèƒ½ï¼Œå‰ææ˜¯è¦åœ¨ <code>manifest.json</code> ä¸­å£°æ˜äº†æ‰€éœ€çš„æƒé™ã€‚</li> <li><strong>Toolbar icon</strong>ï¼šæµè§ˆå™¨å·¥å…·æ ä¸Šæ˜¾ç¤ºçš„æ’ä»¶å›¾æ ‡ã€‚ç”¨æˆ·å¯ä»¥å•å‡»å›¾æ ‡ä¸ä¸€ä¸ªä½¿ç”¨å¼¹å‡ºæ¡†è¿›è¡Œäº¤äº’ã€‚</li> <li><strong>UI elements</strong>ï¼šç”¨æˆ·äº¤äº’çš„å…ƒç´ ï¼ŒåŒ…æ‹¬ï¼šä¸Šé¢è¯´çš„ç‚¹å‡»å›¾æ ‡å’Œå¼¹çª—ã€å³é”®èœå•ã€åœ°å€æ æœç´¢é€‰æ‹©æ’ä»¶ã€å¿«æ·é”®å”¤èµ·ç­‰ï¼Œç”šè‡³è¿˜å¯ä»¥åœ¨é¡µé¢ä¸­æ’å…¥è‡ªå®šä¹‰ç»„ä»¶ã€‚</li> <li><strong>Content script</strong>ï¼šå†…å®¹è„šæœ¬å…è®¸æ’ä»¶å°†é€»è¾‘æ³¨å…¥é¡µé¢ï¼Œä»¥è¯»å–å’Œä¿®æ”¹å…¶å†…å®¹ã€‚ å†…å®¹è„šæœ¬å¯ä»¥åœ¨å·²åŠ è½½åˆ°æµè§ˆå™¨ä¸­çš„é¡µé¢ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œçš„ JavaScriptï¼Œä¾‹å¦‚ä¸Šé¢è¯´çš„åœ¨é¡µé¢ä¸­æ’å…¥è‡ªå®šä¹‰ç»„ä»¶ã€‚</li> <li><strong>Options page</strong>ï¼šé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯æ’ä»¶çš„é…ç½®é¡µé¢ï¼Œå¯ä»¥å¯¹æ’ä»¶è¿›è¡Œä¸€äº›é…ç½®æ“ä½œã€‚</li></ul> <h3 id="manifest"><a href="#manifest" class="header-anchor">#</a> Manifest</h3> <p>å®˜æ–¹è¦æ±‚çš„æ˜¯ <code>manifest.json</code> æ–‡ä»¶ï¼Œè¿™é‡Œå…ˆç”¨ js æ¥ä»£æ›¿ï¼Œç¼–è¯‘é˜¶æ®µå†è½¬æ¢æ–‡ä»¶æ ¼å¼ã€‚æœ¬æ¬¡å¼€å‘çš„é…ç½®å¦‚ä¸‹ï¼š</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> packageJson <span class="token keyword">from</span> <span class="token string">&quot;../package.json&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ManifestType <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@src/manifest-type&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token literal-property property">manifest</span><span class="token operator">:</span> ManifestType <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">manifest_version</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> packageJson<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
  <span class="token literal-property property">version</span><span class="token operator">:</span> packageJson<span class="token punctuation">.</span>version<span class="token punctuation">,</span>	<span class="token comment">// å½“å‰æ’ä»¶ç‰ˆæœ¬</span>
  <span class="token literal-property property">description</span><span class="token operator">:</span> packageJson<span class="token punctuation">.</span>description<span class="token punctuation">,</span>
  <span class="token literal-property property">icons</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// ä¸åŒå°ºå¯¸ä½¿ç”¨åœºæ™¯ä¸åŒ,</span>
    <span class="token string-property property">&quot;16&quot;</span><span class="token operator">:</span> <span class="token string">&quot;icon16.png&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;32&quot;</span><span class="token operator">:</span> <span class="token string">&quot;icon32.png&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;48&quot;</span><span class="token operator">:</span> <span class="token string">&quot;icon48.png&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;128&quot;</span><span class="token operator">:</span> <span class="token string">&quot;icon128.png&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">background</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">service_worker</span><span class="token operator">:</span> <span class="token string">&quot;src/pages/background/index.js&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">action</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">default_popup</span><span class="token operator">:</span> <span class="token string">&quot;src/pages/popup/index.html&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">default_icon</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;16&quot;</span><span class="token operator">:</span> <span class="token string">&quot;icon16.png&quot;</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;32&quot;</span><span class="token operator">:</span> <span class="token string">&quot;icon32.png&quot;</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;48&quot;</span><span class="token operator">:</span> <span class="token string">&quot;icon48.png&quot;</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;128&quot;</span><span class="token operator">:</span> <span class="token string">&quot;icon128.png&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">content_scripts</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">matches</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&lt;all_urls&gt;&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">js</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;src/pages/content/index.js&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token comment">// content æ ·å¼éœ€è¦ç‰¹æ®ŠæŒ‡å®šï¼Œè‹¥ä½¿ç”¨ antdï¼Œéœ€è¦å¦å¤–æ·»åŠ  antd éƒ¨åˆ†æ ·å¼</span>
      <span class="token comment">// css: [&quot;assets/css/contentStyle.chunk.css&quot;],</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">options_page</span><span class="token operator">:</span> <span class="token string">&quot;src/pages/options/index.html&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">web_accessible_resources</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">resources</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;assets/js/*.js&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;assets/css/*.css&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">matches</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;*://*/*&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">permissions</span><span class="token operator">:</span> <span class="token punctuation">[</span>	<span class="token comment">// æ“ä½œ chrome çš„æƒé™</span>
    <span class="token string">&quot;storage&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;activeTab&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;scripting&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;contextMenus&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;notifications&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> manifest<span class="token punctuation">;</span>
</code></pre></div><h3 id="ui-elements"><a href="#ui-elements" class="header-anchor">#</a> <strong>UI elements</strong></h3> <p>ä¸Šé¢è¯´åˆ° UI äº¤äº’å¤§å¤šæ•°å°±æ˜¯ï¼Œç‚¹å‡»æ’ä»¶å›¾æ ‡å¼¹çª—ã€å³é”®èœå•ã€åœ¨é¡µé¢ä¸­æ’å…¥è‡ªå®šä¹‰ç»„ä»¶ç­‰ç­‰ã€‚æ²¡é”™ï¼Œå°å­©å­æ‰åšé€‰æ‹©ï¼Œè¿™å‡ ç§æˆ‘å…¨è¦ã€‚</p> <h4 id="content"><a href="#content" class="header-anchor">#</a> Content</h4> <p>å›  chrome æ’ä»¶ä¸æ”¯æŒåœ¨ content scripts ä¸­ä½¿ç”¨ moduleï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨åŠ¨æ€å¼•å…¥ã€‚</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token comment">// src/pages/content/index.ts</span>

<span class="token comment">/**
 * @description
 * chrome æ’ä»¶ä¸æ”¯æŒåœ¨ content scripts ä¸­ä½¿ç”¨ module
 */</span>
<span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&quot;./components/Content&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token comment">// src/pages/content/components/Content/index.tsx</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> createRoot <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react-dom/client&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">&quot;@src/pages/content/components/Content/app&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> root <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
root<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token string">&quot;content-view-root&quot;</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">createRoot</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">App</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>ä»¥ä¸‹é€»è¾‘ç®€å•æ¦‚æ‹¬èµ·æ¥å°±æ˜¯:</p> <ol><li>ç›‘å¬ç”¨æˆ·èšç„¦è¾“å…¥æ¡†ï¼Œä» storage ä¸­è·å–è¯­å½•é›†æ•°æ®ï¼Œåˆ›å»ºä¸€ä¸ªé€‰æ‹©æ¡†æä¾›ç”¨æˆ·é€‰æ‹©å¿«æ·è¾“å…¥ã€‚</li> <li>ç›‘å¬ç”¨æˆ·é€‰ä¸­æ–‡æœ¬ï¼Œè°ƒç”¨ <code>sendMessage</code> å‘ service worker å‘é€è¯·æ±‚ï¼Œç¼“å­˜é€‰ä¸­å†…å®¹ã€‚å³é”®å¯ä»¥åŠ å…¥é€‰ä¸­å†…å®¹ã€‚</li></ol> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token comment">// src/pages/content/components/Content/app.tsx</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> useEffect<span class="token punctuation">,</span> useRef<span class="token punctuation">,</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createPopper <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@popperjs/core/lib/popper-lite.js'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> preventOverflow <span class="token keyword">from</span> <span class="token string">'@popperjs/core/lib/modifiers/preventOverflow.js'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> focusTargetRef <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useRef</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> toolTargetRef <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useRef</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>sentences<span class="token punctuation">,</span> setSentences<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// capture: true èšç„¦äº‹ä»¶ä¸ä¼šå†’æ³¡ï¼Œä½†æ˜¯å¯ä»¥åœ¨æ•è·é˜¶æ®µè§¦å‘</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'focus'</span><span class="token punctuation">,</span> handleFocus<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'blur'</span><span class="token punctuation">,</span> handleBlur<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token comment">// ç›‘å¬æ–‡å­—é€‰ä¸­</span>
    document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;selectionchange&quot;</span><span class="token punctuation">,</span> handleSelectionChange<span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'focus'</span><span class="token punctuation">,</span> handleFocus<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
      document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'blur'</span><span class="token punctuation">,</span> handleBlur<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
      document<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;selectionchange&quot;</span><span class="token punctuation">,</span> handleSelectionChange<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleFocus</span><span class="token punctuation">(</span>event<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// åªæœ‰å¯ç¼–è¾‘å…ƒç´ æ‰å¼¹çª—</span>
    <span class="token keyword">const</span> target <span class="token operator">=</span> event<span class="token operator">?.</span>target
    <span class="token keyword">if</span><span class="token punctuation">(</span>target<span class="token operator">?.</span>isContentEditable <span class="token operator">||</span> target<span class="token operator">?.</span>tagName <span class="token operator">===</span> <span class="token string">'INPUT'</span> <span class="token operator">||</span> target<span class="token operator">?.</span>tagName <span class="token operator">===</span> <span class="token string">'TEXTAREA'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      chrome<span class="token punctuation">.</span>storage<span class="token punctuation">.</span>sync<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;sentences&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> sentences <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>sentences <span class="token operator">||</span> <span class="token operator">!</span>sentences<span class="token operator">?.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span>
        <span class="token punctuation">}</span>
        <span class="token function">setSentences</span><span class="token punctuation">(</span>sentences<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      focusTargetRef<span class="token punctuation">.</span>current <span class="token operator">=</span> target
      <span class="token keyword">const</span> popperInstance <span class="token operator">=</span> <span class="token function">createPopper</span><span class="token punctuation">(</span>target <span class="token keyword">as</span> HTMLElement<span class="token punctuation">,</span> toolTargetRef<span class="token punctuation">.</span>current<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token comment">// çœç•¥é…ç½®</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      toolTargetRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'data-show'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      popperInstance<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">handleBlur</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      toolTargetRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span><span class="token string">'data-show'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">handleSelectionChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// è·å–é€‰ä¸­æ–‡æœ¬</span>
    chrome<span class="token operator">?.</span>runtime<span class="token operator">?.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span> action<span class="token operator">:</span> <span class="token string">'add'</span><span class="token punctuation">,</span> data<span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">handleInput</span><span class="token punctuation">(</span>info<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> target <span class="token operator">=</span> focusTargetRef<span class="token operator">?.</span>current
    <span class="token keyword">if</span><span class="token punctuation">(</span>target<span class="token operator">?.</span>isContentEditable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      focusTargetRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span>innerText <span class="token operator">=</span> info
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>target<span class="token operator">?.</span>tagName <span class="token operator">===</span> <span class="token string">'INPUT'</span> <span class="token operator">||</span> target<span class="token operator">?.</span>tagName <span class="token operator">===</span> <span class="token string">'TEXTAREA'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      focusTargetRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span>value <span class="token operator">=</span> info
    <span class="token punctuation">}</span>

    <span class="token comment">// è‡ªå®šä¹‰è§¦å‘è¾“å…¥äº‹ä»¶</span>
    <span class="token keyword">const</span> event <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Event</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> bubbles<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> cancelable<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    focusTargetRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tooltip<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>toolTargetRef<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span> sentences<span class="token operator">?.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>sentence<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>sentence-item<span class="token punctuation">'</span></span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>index<span class="token punctuation">}</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">handleInput</span><span class="token punctuation">(</span>sentence<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>sentence<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="popup"><a href="#popup" class="header-anchor">#</a> Popup</h4> <p>Popup é¡µé¢æ˜¯ç”¨æˆ·ç‚¹å‡»æ’ä»¶å›¾æ ‡ä»¥åå‡ºç°çš„å¼¹çª—ï¼Œæˆ‘ä»¬å®šä¸€ä¸ª html æ¨¡ç‰ˆé¡µé¢ã€‚
<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a25e58c9b9c64e77b2b317bcb9ee5a92~tplv-k3u1fbpfcp-zoom-1.image" alt="image.png"></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- src/pages/popup/index.html --&gt;</span>

<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>zh-CN<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>icon<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>image/svg+xml<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/react.svg<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Popup<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./index.tsx<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>æ¥ç€å¼•å…¥ç»„ä»¶ç›¸å…³é¡µé¢ã€‚</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token comment">// src/pages/popup/index.tsx</span>

<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createRoot <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react-dom/client&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Popup <span class="token keyword">from</span> <span class="token string">&quot;@pages/popup/Popup&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&quot;@pages/popup/index.less&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> root <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>root<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Can not find root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">createRoot</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Popup</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>Popup ç»„ä»¶é¡µé¢åŠŸèƒ½ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œä¸»è¦è°ƒç”¨æ¥å£è·å–æ•°æ®å±•ç¤ºã€åˆ·æ–°ã€åŠ å…¥è¯­å½•é›†ç­‰ç­‰ã€‚</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token comment">// src/pages/popup/Popup.tsx</span>

<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useEffect<span class="token punctuation">,</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&quot;@pages/popup/Popup.less&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Card <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> CopyOutlined<span class="token punctuation">,</span> ReloadOutlined<span class="token punctuation">,</span> FileAddOutlined <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@ant-design/icons'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> CopyToClipboard <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-copy-to-clipboard'</span>

<span class="token keyword">const</span> <span class="token function-variable function">Popup</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>sentence<span class="token punctuation">,</span> setSentence<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">getSentence</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getSentence</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://api.oick.cn/dutang/api.php'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      method<span class="token operator">:</span> <span class="token string">'GET'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> nextSentence <span class="token operator">=</span> <span class="token keyword">await</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">setSentence</span><span class="token punctuation">(</span>nextSentence<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> <span class="token function-variable function">handleAdd</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    chrome<span class="token punctuation">.</span>storage<span class="token punctuation">.</span>sync<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;sentences&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> sentences <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      chrome<span class="token punctuation">.</span>storage<span class="token punctuation">.</span>sync<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span> sentences<span class="token operator">:</span> <span class="token punctuation">[</span>sentence<span class="token punctuation">,</span> <span class="token operator">...</span>sentences<span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> <span class="token function-variable function">handleReload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">getSentence</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>popup-container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Card</span></span> 
        <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> width<span class="token operator">:</span> <span class="token number">300</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
        <span class="token attr-name">actions</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">FileAddOutlined</span></span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>add<span class="token punctuation">'</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>handleAdd<span class="token punctuation">}</span></span><span class="token punctuation">/&gt;</span></span><span class="token punctuation">,</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">CopyToClipboard</span></span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>copy<span class="token punctuation">&quot;</span></span> <span class="token attr-name">text</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>sentence<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">CopyOutlined</span></span><span class="token punctuation">/&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">CopyToClipboard</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ReloadOutlined</span></span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>reload<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>handleReload<span class="token punctuation">}</span></span><span class="token punctuation">/&gt;</span></span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">}</span></span>
      <span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> minHeight<span class="token operator">:</span> <span class="token number">60</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span> sentence <span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Card</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Popup<span class="token punctuation">;</span>

</code></pre></div><h4 id="options"><a href="#options" class="header-anchor">#</a> Options</h4> <p>Optinos é¡µé¢ä¸ Popup é¡µé¢çš„ä»£ç ç±»ä¼¼å°±ä¸å†èµ˜è¿°ï¼Œæ­¤é¡µé¢å¯ä»¥é€šè¿‡å³é”®æ’ä»¶å›¾æ ‡ -- é€‰æ‹©â€œé€‰é¡¹â€è¿›å…¥ï¼Œé¡µé¢æ”¯æŒå¤åˆ¶ã€ç¼–è¾‘ã€åˆ é™¤ã€æ–°å¢ç­‰ç­‰ï¼ŒUI å±•ç¤ºå¦‚ä¸‹ï¼š
<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e949da75051845ff8e25e87777f3bb7d~tplv-k3u1fbpfcp-zoom-1.image" alt="image.png"></p> <h3 id="service-worker"><a href="#service-worker" class="header-anchor">#</a> <strong>Service worker</strong></h3> <p>è¿™éƒ¨åˆ†æˆ‘ä»¬ä¸»è¦ç”¨åˆ°äº†æ’ä»¶çš„ contextMenus å³é”®èœå•ã€storage å­˜å‚¨æ•°æ®ã€notifications é€šçŸ¥ç­‰åŠŸèƒ½ï¼Œè¿™äº›åŠŸèƒ½æˆ‘ä»¬éƒ½éœ€è¦åœ¨ Manifest é‡Œé…ç½®ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// src/pages/background/index.ts</span>

<span class="token keyword">let</span> selectedSentence <span class="token operator">=</span> <span class="token string">''</span>

chrome<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>onInstalled<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// å³é”®èœå•ç®¡ç†</span>
  chrome<span class="token punctuation">.</span>contextMenus<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;type&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;normal&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;title&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;æ–°å¢è¯­å½•&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">contexts</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'selection'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

chrome<span class="token punctuation">.</span>contextMenus<span class="token punctuation">.</span>onClicked<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">addSentence</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
                                         <span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">addSentence</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  chrome<span class="token punctuation">.</span>storage<span class="token punctuation">.</span>sync<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;sentences&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> sentences <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    chrome<span class="token punctuation">.</span>storage<span class="token punctuation">.</span>sync<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">sentences</span><span class="token operator">:</span> <span class="token punctuation">[</span>selectedSentence<span class="token punctuation">,</span> <span class="token operator">...</span>sentences<span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">showNotification</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

chrome<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>onMessage<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> data<span class="token punctuation">,</span> action <span class="token punctuation">}</span> <span class="token operator">=</span> request<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>action <span class="token operator">===</span> <span class="token string">'add'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      selectedSentence <span class="token operator">=</span> data
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">showNotification</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  chrome<span class="token punctuation">.</span>notifications<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'basic'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">iconUrl</span><span class="token operator">:</span> <span class="token string">'./images/icon.png'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'æ“ä½œæˆåŠŸ'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">priority</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="åŠ è½½ä¸è°ƒè¯•"><a href="#åŠ è½½ä¸è°ƒè¯•" class="header-anchor">#</a> åŠ è½½ä¸è°ƒè¯•</h2> <h3 id="åŠ è½½æœ¬åœ°æ’ä»¶"><a href="#åŠ è½½æœ¬åœ°æ’ä»¶" class="header-anchor">#</a> åŠ è½½æœ¬åœ°æ’ä»¶</h3> <p>å­˜æ”¾æ¸…å•æ–‡ä»¶çš„ç›®å½•å¯ä»¥åœ¨å¼€å‘è€…æ¨¡å¼ä¸‹æ·»åŠ ä¸ºæ’ä»¶ï¼Œæ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š</p> <ol><li>æµè§ˆå™¨è¾“å…¥ <code>chrome://extensions</code> å¯ä»¥æ‰“å¼€æ’ä»¶ç®¡ç†é¡µé¢
<ul><li>å¦å¤–ï¼Œå¯ä»¥ç‚¹å‡»å³ä¸Šè§’æ’ä»¶ç®¡ç†çš„å›¾æ ‡ï¼Œåœ¨å¼¹çª—èœå•åº•éƒ¨é€‰æ‹©ç®¡ç†æ‰©å±•ç¨‹åºã€‚</li> <li>å¦å¤–ï¼Œè¿˜å¯ä»¥ç‚¹å‡»å³ä¸Šè§’è®¾ç½®æŒ‰é’®ï¼Œåœ¨å¼¹çª—èœå•ä¸­é€‰æ‹©æ›´å¤šå·¥å…·--æ‰©å±•ç¨‹åºã€‚</li></ul></li> <li>é€šè¿‡ç‚¹å‡»å¼€å‘è€…æ¨¡å¼æ—è¾¹çš„å¼€å…³æ¥å¯ç”¨å¼€å‘äººå‘˜æ¨¡å¼ã€‚</li> <li>æœ€åç‚¹å‡»å·¦ä¸Šè§’åŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åºé€‰æ‹©ç¼–è¯‘å¥½çš„ç›®å½•å³å¯æˆåŠŸåŠ è½½ã€‚</li></ol> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5a02470be7d3414abba523a75cb22dfc~tplv-k3u1fbpfcp-zoom-1.image" alt="image.png"></p> <h3 id="è°ƒè¯•æ¨¡å¼"><a href="#è°ƒè¯•æ¨¡å¼" class="header-anchor">#</a> è°ƒè¯•æ¨¡å¼</h3> <p>æˆ‘ä»¬ä¿®æ”¹äº†ä»£ç ä»¥åï¼Œ<code>nodemon</code> è‡ªåŠ¨æ›´æ–°ä»¥åï¼Œæˆ‘ä»¬éœ€è¦å†
å¯¹äº background çš„è°ƒè¯•ï¼Œå¯ä»¥åœ¨æ’ä»¶ç®¡ç†é¡µé¢ä¸Šç‚¹å‡» <code>Service Worker</code> <img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5158f2b3d0b74e54a7a2c9458c494ae2~tplv-k3u1fbpfcp-zoom-1.image" alt="image.png">
å¯¹äº Popupã€Optionsã€Content ç­‰éƒ½æ˜¯é¡µé¢ï¼Œå¯ä»¥åœ¨å¯¹åº”çš„é¡µé¢ä¸Šå³é”®é€‰æ‹©æ£€æŸ¥å³å¯ï¼Œåç»­çš„è°ƒè¯•æ­¥éª¤å’Œæ™®é€šé¡µé¢ä¸€æ ·ã€‚</p> <h2 id="æ¨¡å—é—´é€šä¿¡"><a href="#æ¨¡å—é—´é€šä¿¡" class="header-anchor">#</a> æ¨¡å—é—´é€šä¿¡</h2> <p>ç»„ä»¶çš„ <code>background</code>ã€<code>popup</code>ã€<code>content</code> ä¸‰è€…ä¹‹é—´å…³ç³»å›¾å¦‚ä¸‹:
<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/50846b0975bf42d8b3c276327cbd8696~tplv-k3u1fbpfcp-zoom-1.image" alt="image.png"></p> <ul><li>content script ä¸ service worker / popup</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>chrome<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>onMessage<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> sender<span class="token punctuation">,</span> sendResponse</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token function">sendResponse</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token keyword">const</span> <span class="token function-variable function">getCurrentTab</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">let</span> queryOptions <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">active</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">currentWindow</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token keyword">let</span> <span class="token punctuation">[</span>tab<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> chrome<span class="token punctuation">.</span>tabs<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>queryOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> tab<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">await</span> chrome<span class="token punctuation">.</span>tabs<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>tab<span class="token punctuation">.</span>id<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>popup ä¸ service worker</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>chrome<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>


chrome<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>onMessage<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> sender<span class="token punctuation">,</span> sendResponse</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token function">sendResponse</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7d70c501950e439c99054a460175e882~tplv-k3u1fbpfcp-zoom-1.image" alt="æœªå‘½å.png"></p> <h2 id="æ‰“åŒ…å‘å¸ƒ"><a href="#æ‰“åŒ…å‘å¸ƒ" class="header-anchor">#</a> æ‰“åŒ…å‘å¸ƒ</h2> <p>å‘å¸ƒè„šæœ¬ä¸»è¦åšäº†ä»¥ä¸‹å‡ ä¸ªæ“ä½œï¼š</p> <ul><li><strong>ç‰ˆæœ¬å·æ›´æ–°</strong> <ul><li>ä½¿ç”¨ <code>node-semver</code> å‡çº§ç‰ˆæœ¬å·</li> <li>ä½¿ç”¨ <code>sed</code> å‘½ä»¤ä¿®æ”¹æ–‡ä»¶ï¼Œ<code>node fs</code> ä¹Ÿè¡Œ</li></ul></li> <li>æ„å»ºå®Œäº†ä¹‹åè¦<strong>å‹ç¼©æ•´ä¸ª distï¼Œå¿…é¡»è¦å‹ç¼©æ‰èƒ½å‘å¸ƒåˆ° Chrome Extension Store</strong></li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// build.mjs</span>

#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env zx

<span class="token keyword">const</span> semverInc <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'semver/functions/inc'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> packageJson <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./package.json'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// let {version} = await fs.readJson('./package.json')</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
  chalk<span class="token punctuation">.</span>yellow<span class="token punctuation">.</span><span class="token function">bold</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Current verion: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>packageJson<span class="token punctuation">.</span>version<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>

<span class="token keyword">let</span> types <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'major'</span><span class="token punctuation">,</span> <span class="token string">'minor'</span><span class="token punctuation">,</span> <span class="token string">'patch'</span><span class="token punctuation">]</span>
<span class="token keyword">let</span> type <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">question</span><span class="token punctuation">(</span>
  chalk<span class="token punctuation">.</span><span class="token function">cyan</span><span class="token punctuation">(</span>
    <span class="token string">'Release type? Press Tab twice for suggestion \n'</span>
  <span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">choices</span><span class="token operator">:</span> types<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
<span class="token keyword">let</span> version <span class="token operator">=</span> <span class="token string">''</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">!==</span> <span class="token string">''</span> <span class="token operator">||</span> types<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  version <span class="token operator">=</span> <span class="token function">semverInc</span><span class="token punctuation">(</span>packageJson<span class="token punctuation">.</span>version<span class="token punctuation">,</span> type<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
    chalk<span class="token punctuation">.</span>green<span class="token punctuation">.</span><span class="token function">bold</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Release verion? </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>version<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
  <span class="token comment">// ä½¿ç”¨ sed å‘½ä»¤ä¿®æ”¹ versionï¼Œç”¨ node fs ä¿®æ”¹ä¹Ÿè¡Œ</span>
  $<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">sed -i '' s/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>packageJson<span class="token punctuation">.</span>version<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>version<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/g package.json</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> $<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">exit 1</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span>

<span class="token comment">// æ„å»º</span>
<span class="token keyword">await</span> $<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">tsc &amp;&amp; vite build</span><span class="token template-punctuation string">`</span></span>

<span class="token comment">// git</span>
<span class="token keyword">await</span> $<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">git add .</span><span class="token template-punctuation string">`</span></span>
<span class="token keyword">await</span> $<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">git commit -m 'Update version to </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>version<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">'</span><span class="token template-punctuation string">`</span></span>
<span class="token keyword">await</span> $<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">git tag v</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>version<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
<span class="token keyword">await</span> $<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">git push origin refs/tags/v</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>version<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
<span class="token keyword">await</span> $<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">git push origin HEAD:refs/for/master</span><span class="token template-punctuation string">`</span></span>

<span class="token comment">// å‹ç¼©</span>
<span class="token keyword">await</span> $<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">zip -q -r bundle.zip ./dist</span><span class="token template-punctuation string">`</span></span>
</code></pre></div><ul><li><a href="https://chrome.google.com/webstore/devconsole/register?hl=zh-CN" target="_blank" rel="noopener noreferrer">Chrome åº”ç”¨å•†åº— - å¼€å‘è€…åè®®<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> å¼€å‘è€…éœ€è¦äº¤çº³ 5ç¾å…ƒï¼Œæ‰å¯ä»¥å‘å¸ƒä»£ç åˆ° Chrome Extension Store</li></ul> <p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5ae32d15f35b4a9487fb3366c53dbbbe~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p> <h2 id="ç»“æŸè¯­"><a href="#ç»“æŸè¯­" class="header-anchor">#</a> ç»“æŸè¯­</h2> <p><a href="https://github.com/guyon-better/quotation" target="_blank" rel="noopener noreferrer">ä»“åº“åœ°å€<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
è‡³æ­¤ä¸€ä¸ªç®€å•çš„æµè§ˆå™¨æ’ä»¶å°±å¼€å‘å®Œæˆäº†ï¼Œå¤§ä¼™æœ‰ä»€ä¹ˆç–‘é—®çš„è¯å¯ä»¥ç•™è¨€ç›¸äº’æ¢è®¨ä¸€ä¸‹ã€‚</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/space/blog/12.html" class="prev">
        è¿™ä¹ˆå¤šå¹´ä½ è¿˜åœ¨æ€•æ­£åˆ™å—ï¼Ÿ
      </a></span> <span class="next"><a href="/space/blog/10.html">
        ä¼—æ‰€å‘¨çŸ¥çš„æµè§ˆå™¨è°ƒè¯•æ“ä½œ
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/space/assets/js/app.c334109e.js" defer></script><script src="/space/assets/js/2.733019b2.js" defer></script><script src="/space/assets/js/12.b9c16781.js" defer></script>
  </body>
</html>
